# kintone 部分一致検索プラグイン

本ドキュメントは、**Codex の Vibe Coding（自然言語ベースの実装指示）にそのまま投入できること**を目的とした設計ドキュメントです。
実装者（AI / 人間）に対して「何を・どう作るか」が曖昧にならない粒度で記載しています。

---

## 1. 目的

* kintone 標準検索では英単語（スペース区切り文字列）の部分一致検索が期待通りに動作しない
* これを解決するため、**JavaScript 側で部分一致ロジックを制御する kintone プラグイン**を作成する
* 一覧画面上部に検索UIを表示し、入力内容に応じて一覧表示を動的にフィルタリングする

---

## 2. 対象画面

* kintone アプリの **一覧画面（index view）** のみ
* レコード詳細画面・編集画面には影響を与えない

---

## 3. プラグインの基本仕様

### 3.1 表示仕様

* 一覧画面の上部（ヘッダ領域）に検索UIを表示する
* 検索UIは以下の要素で構成する

  * テキスト入力欄（1つ）
  * 検索実行ボタン
  * （任意）クリアボタン

---

### 3.2 検索仕様

* 入力された文字列を用いて **部分一致検索** を行う
* 検索対象は、プラグイン設定画面で指定されたフィールドのみ
* 検索ロジックは kintone 標準検索を使用せず、以下の方式を採用する

#### 検索方式

1. kintone REST API を使用してレコードを取得
2. JavaScript 上で文字列比較を行う
3. 条件に一致したレコードのみを一覧として表示する

#### 部分一致の定義

* `includes()` による単純部分一致
* 英数字・英単語・スペース区切り文字列もそのまま評価対象とする
* 大文字・小文字は区別しない（比較前に小文字化）

---

### 3.3 検索条件の扱い

* 単一入力欄での検索とする
* 複数フィールドは **OR 条件** で評価する

  * いずれかのフィールドに部分一致すればヒット

---

## 4. プラグイン設定画面仕様

### 4.1 設定項目

* 検索対象フィールド

  * 文字列（1行）
  * 文字列（複数行）
  * 数値（文字列変換して比較）
  * ルックアップ（表示値）

※ 添付ファイル、ユーザー選択などは対象外

---

### 4.2 設定UI仕様

* フィールド一覧を取得し、チェックボックスで複数選択可能とする
* 選択されたフィールドコードをプラグイン設定として保存する

---

### 4.3 設定データ形式（例）

```json
{
  "targetFields": [
    "customer_name",
    "product_name",
    "remarks"
  ]
}
```

---

## 5. 一覧画面での動作仕様

### 5.1 初期表示

* プラグインは一覧表示イベントで初期化される
* 初期状態では **標準一覧をそのまま表示** する

---

### 5.2 検索実行時の処理フロー

1. 入力欄の文字列を取得
2. プラグイン設定から検索対象フィールドを取得
3. kintone REST API でレコード取得
4. 各レコードに対して以下を実行

   * 対象フィールドの値を文字列化
   * 小文字変換
   * 入力文字列が含まれるか判定
5. 一致したレコードのみ配列に格納
6. プラグイン独自の一覧HTMLを生成
7. 標準一覧の代わりに表示

---

### 5.3 表示方法

* 標準一覧のDOMは操作しない
* プラグインが用意した領域に **擬似一覧（テーブル）** を描画する
* 列構成は以下のいずれか

  * 固定（フィールドコード直書き）
  * または設定で指定（将来拡張）

---

## 6. 非機能要件

### 6.1 パフォーマンス

* レコード数が多い場合に備え、以下を考慮する

  * 1回の取得件数制限（例：500件）
  * ページング処理
* 初期実装では全件取得でも可とする

---

### 6.2 保守性

* ロジックは以下の単位で分離する

  * UI生成
  * API通信
  * 検索ロジック
  * 描画処理

---

## 7. 使用する kintone API / イベント

* `kintone.events.on('app.record.index.show')`
* `kintone.app.getHeaderSpaceElement()`
* `kintone.api()`
* `kintone.plugin.app.getConfig()`
* `kintone.plugin.app.setConfig()`

---

## 8. Vibe Coding 用 実装指示テンプレート（そのまま使える形）

以下は Codex に投入する前提の指示文例。

---

### 実装指示

```
あなたは kintone プラグイン開発者です。

以下の仕様を満たす kintone プラグインの JavaScript を実装してください。

- 一覧画面でのみ動作する
- 一覧上部に検索用テキストボックスと検索ボタンを表示する
- プラグイン設定で指定されたフィールドを検索対象とする
- 検索は JavaScript による部分一致（includes）で行う
- 英単語・スペース区切り文字列も正しく部分一致すること
- 大文字小文字は区別しない
- kintone REST API でレコードを取得し、ヒットしたレコードのみを表示する
- 標準一覧は操作せず、プラグイン独自の一覧を描画する
```

---

## 9. 将来拡張（今回は未対応）

* AND / OR 条件切り替え
* 即時検索（keyup）
* 検索条件の保持
* 標準一覧との完全な置き換え

---

以上
